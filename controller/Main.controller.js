sap.ui.define(["./BaseController","../model/models","../model/formatter","../model/Dialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageBox"],(e,t,o,s,r,a,i,n)=>{"use strict";return e.extend("cles.agenti.controller.Main",{formatter:o,onInit(){this.getRouter().getRoute("RouteMain").attachPatternMatched(this._onObjectMatched,this);this.getView().setModel(t.createMainModel(),"main")},onAfterRendering(){this.onGroupByCategory()},_onObjectMatched(e){const{arguments:t}=e.getParameters();if(t["?query"]){const{customer:e,customer_name:o}=t["?query"];this.getModel("main").setProperty("/header/customer/id",e);this.getModel("main").setProperty("/header/customer/name",o)}},_getCells(){return[new sap.m.Text({text:"{proposta>category}"}),new sap.m.Input({value:"{proposta>product}",showValueHelp:true,editable:"{= ${proposta>product} ? false : true }",valueHelpRequest:this.onProductValueHelpRequest.bind(this),valueHelpOnly:true}),new sap.m.Text({text:"{proposta>description}"}),new sap.m.Text({text:"{proposta>u_acq}"}),new sap.m.Text({text:"{proposta>u_prz}"}),new sap.m.Text({text:"{proposta>u_qta}"}),new sap.m.Text({text:"{proposta>disponibilita}"}),new sap.m.Select({items:[{key:"PZ",text:"PZ"},{key:"KG",text:"KG"}],selectedKey:"KG"}),new sap.m.Input({value:"{proposta>price}"}),new sap.m.StepInput({value:"{proposta>quantity}",displayValuePrecision:1,step:.1,change:this.onStepInputQuantityChange}),new sap.m.HBox({height:"100%",width:"100%",justifyContent:"End",items:[new sap.m.Button({tooltip:"Note",icon:"sap-icon://notes",press:this.onAddNotePress.bind(this)}).addStyleClass("sapUiTinyMarginBegin"),new sap.m.Button({tooltip:"Foto",icon:"sap-icon://camera",press:this.onShowPhotoPress.bind(this)}).addStyleClass("sapUiTinyMarginBegin")]}).addStyleClass("sapUiSmallMarginTopBottom")]},onStepInputQuantityChange(e){const t=e.getSource().getBindingContext("proposta");const o=t.getPath();const s=t.getModel();s.setProperty(o+"/selected",true)},onGroupByCategory(){const e=this.byId("lista_odv");if(!e)return;const{groupByCategory:t}=this.getModel("proposta").getProperty("/table/toolbar");if(t){this.getModel("proposta").setProperty("/table/columns/categoryColumnVisible",false);e.bindAggregation("items",{path:"proposta>/table/items",sorter:new sap.ui.model.Sorter({path:"category",descending:false,group:this.getCategory}),groupHeaderFactory:this.getCategoryHeader,template:new sap.m.ColumnListItem({highlight:"{proposta>highlight}",vAlign:"Middle",cells:this._getCells(),selected:"{proposta>selected}"})})}else{this.getModel("proposta").setProperty("/table/columns/categoryColumnVisible",true);e.bindAggregation("items",{path:"proposta>/table/items",template:new sap.m.ColumnListItem({highlight:"{proposta>highlight}",vAlign:"Middle",cells:this._getCells(),selected:"{proposta>selected}"})})}},onSearch(e){const{newValue:t}=e.getParameters();const o=this.byId("lista_odv");const s=o.getBinding("items");if(!t)return s.filter([]);return s.filter([new r({filters:[new r({path:"category",operator:a.Contains,value1:t}),new r({path:"description",operator:a.Contains,value1:t})],and:false})])},getCategory(e){return e.getProperty("category")},getCategoryHeader(e){return new sap.m.GroupHeaderListItem({title:"Categoria: "+e.key})},onHeaderAttachmentPress(){s.getAttachmentDialog({controller:this})},onHeaderAttachmentItemPress(e){const t=new sap.m.PDFViewer({title:"Allegato",isTrustedSource:true});this.getView().addDependent(t);t.setSource(sap.ui.require.toUrl("https://sapui5.hana.ondemand.com/sap/m/sample/PDFViewerPopup/sample1.pdf"));t.open()},onCustomerValueHelpRequest(){s.getCustomerValueHelp({controller:this})},onCustomerValueHelpConfirm(e){const{selectedItem:t}=e.getParameters();if(!t)return;const o=t.getBindingContext();this.getModel("main").setProperty("/header/customer/id",o.getProperty("name"));this.getModel("main").setProperty("/header/customer/name",o.getProperty("description"))},onCategoryValueHelpRequest(){s.getCategoryValueHelp({controller:this})},onCategoryValueHelpConfirm(e){const{selectedItem:t}=e.getParameters();if(!t)return;const o=t.getBindingContext();this.getModel("proposta").setProperty("/table/items/0",{...this.getModel("proposta").getProperty("/table/items/0"),category:o.getProperty("description")})},onProductValueHelpRequest(){s.getProductValueHelp({controller:this})},onProductValueHelpConfirm(e){const{selectedItem:t}=e.getParameters();if(!t)return;const o=t.getBindingContext();this.getModel("proposta").setProperty("/table/items/0",{...this.getModel("proposta").getProperty("/table/items/0"),...o.getObject(),product:o.getProperty("name"),disponibilita:o.getProperty("disponibilita")})},onAddRowPress(e){const t=e.getSource().getParent().getParent();const o=t.getModel("proposta").getProperty("/table/items");o.unshift({selected:false,highlight:"Indication01",category:"",product:"",description:"",u_acq:"",u_prz:"",u_qta:"",price:"",unit_of_measure:"KG",quantity:"",disponibilita:""});t.getModel("proposta").setProperty(`/table/items`,o)},onAddNotePress(e){const t=e.getSource();const o=t.getBindingContext("proposta").getObject();s.getAddNoteDialog({controller:this,prodotto:o})},onShowPhotoPress(){s.getPhotoDialog({controller:this})},onPanelProcessFlowExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const s=o.getContent()[0].getItems()[1].getItems()[0];const{top:r}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{s.setZoomLevel("Four");t.getScrollDelegate().scrollTo(0,r)},500)}},onPanelPosizioniExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const{top:s}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{t.getScrollDelegate().scrollTo(0,s)},500)}},onNodePress(e){var t=e.getParameters();var o=t.getBindingContext("storico").getPath();if(!this.oQuickView){i.load({name:"cles.agenti.view.fragment.QuickView",type:"XML"}).then(function(e){this.oQuickView=e;this.getView().addDependent(this.oQuickView);this.oQuickView.bindElement({path:o,model:"storico"});this.oQuickView.openBy(t)}.bind(this))}else{this.oQuickView.bindElement({path:o,model:"storico"});this.oQuickView.openBy(t)}},onCreaOdvPress(){s.getCreaOdVDialog({controller:this})},onCreaOdvConfirm(){n.success("Ordine di vendita creato con successo",{onClose:()=>sap.m.InstanceManager.closeAllDialogs()})},onShowFormPress(e){const t=e.getSource();const o=t.getParent();o.getModel().setProperty("/formVisible",!o.getModel().getProperty("/formVisible"))}})});
//# sourceMappingURL=Main.controller.js.map