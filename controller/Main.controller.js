sap.ui.define(["./BaseController","../model/models","../model/formatter","../model/Dialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageBox"],(e,t,o,r,s,a,n,i)=>{"use strict";return e.extend("cles.agenti.controller.Main",{formatter:o,onInit(){this.getRouter().getRoute("RouteMain").attachPatternMatched(this._onObjectMatched,this);this.getView().setModel(t.createMainModel(),"main")},_onObjectMatched(e){const{arguments:t}=e.getParameters();this.getModel("layout").setProperty("/layoutMode","OneColumn");if(t["?query"]){const{customer:e,customer_name:o}=t["?query"];this.getModel("main").setProperty("/header/customer/id",e);this.getModel("main").setProperty("/header/customer/name",o)}},_getCells(){return[new sap.m.Image({src:"{proposta>src}",width:"5rem",height:"5rem",press:this.onShowPhotoPress.bind(this)}),new sap.m.Text({text:"{proposta>category}"}),new sap.m.Text({text:"{proposta>product} - {proposta>description}"}),new sap.m.Text({text:"{proposta>u_acq}"}),new sap.m.Text({text:"{proposta>u_prz}"}),new sap.m.Text({text:"{proposta>u_qta}"}),new sap.m.Text({text:"{proposta>disponibilita}"}),new sap.m.FlexBox({height:"100%",width:"100%",alignItems:"Center",justifyContent:this.getModel("device").getProperty("/system/desktop")?"SpaceBetween":"Start",direction:this.getModel("device").getProperty("/system/desktop")?"Column":"Row",items:[new sap.m.HBox({alignItems:"Baseline",items:[new sap.m.Button({tooltip:"Note",icon:"sap-icon://notes",badgeStyle:"Default",press:this.onAddNotePress.bind(this),customData:[new sap.m.BadgeCustomData({key:"badge",value:"{proposta>note}",writeToDom:true})]})]})]}).addStyleClass("sapUiSmallMarginTopBottom"),new sap.m.Select({items:[{key:"PZ",text:"PZ"},{key:"KG",text:"KG"}],selectedKey:"KG"}),new sap.m.Input({value:"{proposta>price}"}),new sap.m.StepInput({value:"{proposta>quantity}",displayValuePrecision:0,step:1,change:this.onStepInputQuantityChange}),new sap.m.ObjectStatus({text:"{proposta>status_text}",active:true,inverted:true,state:"{proposta>status_state}"}).addStyleClass("sapUiTinyMarginBegin sapUiTinyMarginTop")]},onStepInputQuantityChange(e){const{value:t}=e.getParameters();const o=e.getSource().getBindingContext("proposta");const r=o.getPath();const s=o.getModel();if(t!==0)s.setProperty(r+"/selected",true);else s.setProperty(r+"/selected",false)},onSearch(e){const{newValue:t}=e.getParameters();const o=this.byId("lista_odv");const r=o.getBinding("items");if(!t)return r.filter([]);return r.filter([new s({filters:[new s({path:"category",operator:a.Contains,value1:t}),new s({path:"description",operator:a.Contains,value1:t})],and:false})])},onFilterPress(e){r.getFiltersDialog({controller:this})},getCategory(e){return e.getProperty("category")},getCategoryHeader(e){return new sap.m.GroupHeaderListItem({title:"Categoria: "+e.key})},onHeaderAttachmentPress(){r.getAttachmentDialog({controller:this})},onHeaderAttachmentItemPress(e){const t=new sap.m.PDFViewer({title:"Allegato",isTrustedSource:true});this.getView().addDependent(t);t.setSource(sap.ui.require.toUrl("https://sapui5.hana.ondemand.com/sap/m/sample/PDFViewerPopup/sample1.pdf"));t.open()},onCustomerValueHelpRequest(){r.getCustomerValueHelp({controller:this})},onPreorderValueHelpRequest(){r.getPreorderValueHelp({controller:this})},onCustomerValueHelpConfirm(e){const t=e.getSource().getParent().getParent().getParent().getParent().getParent();const o=e.getSource();if(!o)return;const r=o.getBindingContext();this.getModel("main").setProperty("/header/customer/id",r.getProperty("id"));this.getModel("main").setProperty("/header/customer/name",r.getProperty("name"));t.close()},onPreorderValueHelpConfirm(e){const t=e.getSource().getParent().getParent();const o=e.getSource();if(!o)return;const r=o.getBindingContext();this.getModel("main").setProperty("/header/preorder/id",r.getProperty("id"));this.getModel("main").setProperty("/header/preorder/name",r.getProperty("name"));t.close()},onCategoryListItemPress(e){const t=e.getParameter("item");const o=this.byId("lista_odv");const r=o.getBinding("items");const n=t.getKey();const i=n==="ALL"?[]:[new s("category",a.EQ,n)];r.filter(i)},onCatalogValueHelpRequest(){r.getCatalogValueHelp({controller:this})},onCatalogValueHelpConfirm(e){const{selectedItems:t}=e.getParameters();if(!t.length)return;const o=this.getModel("proposta").getProperty("/table/items");t.forEach(e=>o.unshift(e.getBindingContext().getObject()));this.getModel("proposta").setProperty("/table/items",o)},onProductListItemPress(e){const t=e.getSource().getBindingContext("proposta").getProperty("product");this.getRouter().navTo("detail",{product:t})},onAddNotePress(e){const t=e.getSource();const o=t.getBindingContext("proposta").getObject();r.getAddNoteDialog({controller:this,prodotto:o})},onShowPhotoPress(e){const t=e.getSource().getProperty("src");r.getPhotoDialog({controller:this,src:t})},onPanelProcessFlowExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const r=o.getContent()[0].getItems()[1].getItems()[0];const{top:s}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{r.setZoomLevel("Four");t.getScrollDelegate().scrollTo(0,s)},500)}},onPanelPosizioniExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const{top:r}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{t.getScrollDelegate().scrollTo(0,r)},500)}},onCreaOdvPress(){r.getCreaOdVDialog({controller:this})},onCreaOdvConfirm(){i.success("Ordine di vendita creato con successo",{onClose:()=>sap.m.InstanceManager.closeAllDialogs()})},onShowFormPress(e){const t=e.getSource();const o=t.getParent();o.getModel().setProperty("/formVisible",!o.getModel().getProperty("/formVisible"))}})});
//# sourceMappingURL=Main.controller.js.map