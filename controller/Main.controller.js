sap.ui.define(["./BaseController","../model/models","../model/formatter","../model/Dialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageBox"],(e,t,o,r,s,n,a,i)=>{"use strict";return e.extend("cles.agenti.controller.Main",{formatter:o,onInit(){this.getRouter().getRoute("RouteMain").attachPatternMatched(this._onObjectMatched,this);this.getView().setModel(t.createMainModel(),"main")},_onObjectMatched(e){const{arguments:t}=e.getParameters();this.getModel("layout").setProperty("/layoutMode","OneColumn");if(t["?query"]){const{customer:e,customer_name:o}=t["?query"];this.getModel("main").setProperty("/header/customer/id",e);this.getModel("main").setProperty("/header/customer/name",o)}},onStepInputQuantityChange(e){const{value:t}=e.getParameters();const o=e.getSource().getBindingContext("proposta");const r=o.getPath();const s=o.getModel();if(t!==0)s.setProperty(r+"/selected",true);else s.setProperty(r+"/selected",false)},onSearch(e){const{newValue:t}=e.getParameters();const o=this.byId("lista_odv");const r=o.getBinding("items");if(!t)return r.filter([]);return r.filter([new s({filters:[new s({path:"category",operator:n.Contains,value1:t}),new s({path:"description",operator:n.Contains,value1:t})],and:false})])},onFilterPress(e){r.getFiltersDialog({controller:this})},getCategory(e){return e.getProperty("category")},getCategoryHeader(e){return new sap.m.GroupHeaderListItem({title:"Categoria: "+e.key})},onHeaderAttachmentPress(){r.getAttachmentDialog({controller:this})},onReportPress(){r.getReportDialog({controller:this})},onHeaderAttachmentItemPress(e){const t=new sap.m.PDFViewer({title:"Allegato",isTrustedSource:true});this.getView().addDependent(t);t.setSource(sap.ui.require.toUrl("https://sapui5.hana.ondemand.com/sap/m/sample/PDFViewerPopup/sample1.pdf"));t.open()},onCustomerValueHelpRequest(){r.getCustomerValueHelp({controller:this})},onPreorderValueHelpRequest(){r.getPreorderValueHelp({controller:this})},onCustomerValueHelpConfirm(e){const t=e.getSource().getParent().getParent().getParent().getParent().getParent();const o=e.getSource();if(!o)return;const r=o.getBindingContext();this.getModel("main").setProperty("/header/customer/id",r.getProperty("id"));this.getModel("main").setProperty("/header/customer/name",r.getProperty("name"));t.close()},onPreorderValueHelpConfirm(e){const t=e.getSource().getParent().getParent();const o=e.getSource();if(!o)return;const r=o.getBindingContext();this.getModel("main").setProperty("/header/preorder/id",r.getProperty("id"));this.getModel("main").setProperty("/header/preorder/name",r.getProperty("name"));t.close()},onCategoryListItemPress(e){const t=e.getParameter("item");const o=this.byId("lista_odv");const r=o.getBinding("items");const a=t.getKey();const i=a==="ALL"?[]:[new s("category",n.EQ,a)];r.filter(i)},onCatalogValueHelpRequest(){r.getCatalogValueHelp({controller:this})},onCatalogValueHelpConfirm(e){const{selectedItems:t}=e.getParameters();if(!t.length)return;const o=this.getModel("proposta").getProperty("/table/items");t.forEach(e=>o.unshift(e.getBindingContext().getObject()));this.getModel("proposta").setProperty("/table/items",o)},onProductListItemPress(e){const{description:t,product:o,src:r}=e.getSource().getBindingContext("proposta").getObject();this.getModel("detail").setData({product:{id:o,description:t,notes:[{nota_1:"test nota 1"}]},carousel:{pages:[{src:r},{src:r},{src:r}]}});this.getRouter().navTo("detail",{product:o})},onPanelProcessFlowExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const r=o.getContent()[0].getItems()[1].getItems()[0];const{top:s}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{r.setZoomLevel("Four");t.getScrollDelegate().scrollTo(0,s)},500)}},onPanelPosizioniExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const{top:r}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{t.getScrollDelegate().scrollTo(0,r)},500)}},onCreaOdvPress(){r.getCreaOdVDialog({controller:this})},onCreaOdvConfirm(){i.success("Ordine di vendita creato con successo",{onClose:()=>sap.m.InstanceManager.closeAllDialogs()})},onShowFormPress(e){const t=e.getSource();const o=t.getParent();o.getModel().setProperty("/formVisible",!o.getModel().getProperty("/formVisible"))}})});
//# sourceMappingURL=Main.controller.js.map