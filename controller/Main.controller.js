sap.ui.define(["./BaseController","../model/models","../model/formatter","../model/Dialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageBox"],(e,t,o,s,r,a,n,i)=>{"use strict";return e.extend("cles.agenti.controller.Main",{formatter:o,onInit(){this.getRouter().getRoute("RouteMain").attachPatternMatched(this._onObjectMatched,this);this.getView().setModel(t.createMainModel(),"main")},onAfterRendering(){this.onGroupByCategory()},_onObjectMatched(e){const{arguments:t}=e.getParameters();if(t["?query"]){const{customer:e,customer_name:o}=t["?query"];this.getModel("main").setProperty("/header/customer/id",e);this.getModel("main").setProperty("/header/customer/name",o)}},_getCells(){return[new sap.m.Image({src:"{proposta>src}",width:"5rem",height:"5rem",press:this.onShowPhotoPress.bind(this)}),new sap.m.Text({text:"{proposta>category}"}),new sap.m.Text({text:"{proposta>product} - {proposta>description}"}),new sap.m.Text({text:"{proposta>u_acq}"}),new sap.m.Text({text:"{proposta>u_prz}"}),new sap.m.Text({text:"{proposta>u_qta}"}),new sap.m.Text({text:"{proposta>disponibilita}"}),new sap.m.Select({items:[{key:"PZ",text:"PZ"},{key:"KG",text:"KG"}],selectedKey:"KG"}),new sap.m.Input({value:"{proposta>price}"}),new sap.m.StepInput({value:"{proposta>quantity}",displayValuePrecision:0,step:1,change:this.onStepInputQuantityChange}),new sap.m.FlexBox({height:"100%",width:"100%",alignItems:"Center",justifyContent:this.getModel("device").getProperty("/system/desktop")?"SpaceBetween":"Start",direction:this.getModel("device").getProperty("/system/desktop")?"Column":"Row",items:[new sap.m.HBox({alignItems:"Baseline",items:[new sap.m.Button({tooltip:"Note",icon:"sap-icon://notes",press:this.onAddNotePress.bind(this)}),new sap.m.ObjectNumber({number:"{proposta>note}"}).addStyleClass("sapUiTinyMarginBegin")]}),new sap.m.ObjectStatus({text:"{proposta>status_text}",active:true,inverted:true,state:"{proposta>status_state}"}).addStyleClass("sapUiTinyMarginBegin sapUiTinyMarginTop")]}).addStyleClass("sapUiSmallMarginTopBottom")]},onStepInputQuantityChange(e){const{value:t}=e.getParameters();const o=e.getSource().getBindingContext("proposta");const s=o.getPath();const r=o.getModel();if(t!==0)r.setProperty(s+"/selected",true);else r.setProperty(s+"/selected",false)},onGroupByCategory(){const e=this.byId("lista_odv");if(!e)return;const{groupByCategory:t}=this.getModel("proposta").getProperty("/table/toolbar");if(t){this.getModel("proposta").setProperty("/table/columns/categoryColumnVisible",false);e.bindAggregation("items",{path:"proposta>/table/items",sorter:new sap.ui.model.Sorter({path:"category",descending:false,group:this.getCategory}),groupHeaderFactory:this.getCategoryHeader,template:new sap.m.ColumnListItem({highlight:"{proposta>highlight}",vAlign:"Middle",cells:this._getCells(),selected:"{proposta>selected}"})})}else{this.getModel("proposta").setProperty("/table/columns/categoryColumnVisible",true);e.bindAggregation("items",{path:"proposta>/table/items",template:new sap.m.ColumnListItem({highlight:"{proposta>highlight}",vAlign:"Middle",cells:this._getCells(),selected:"{proposta>selected}"})})}},onSearch(e){const{newValue:t}=e.getParameters();const o=this.byId("lista_odv");const s=o.getBinding("items");if(!t)return s.filter([]);return s.filter([new r({filters:[new r({path:"category",operator:a.Contains,value1:t}),new r({path:"description",operator:a.Contains,value1:t})],and:false})])},onFilterPress(e){s.getFiltersDialog({controller:this})},getCategory(e){return e.getProperty("category")},getCategoryHeader(e){return new sap.m.GroupHeaderListItem({title:"Categoria: "+e.key})},onHeaderAttachmentPress(){s.getAttachmentDialog({controller:this})},onHeaderAttachmentItemPress(e){const t=new sap.m.PDFViewer({title:"Allegato",isTrustedSource:true});this.getView().addDependent(t);t.setSource(sap.ui.require.toUrl("https://sapui5.hana.ondemand.com/sap/m/sample/PDFViewerPopup/sample1.pdf"));t.open()},onCustomerValueHelpRequest(){s.getCustomerValueHelp({controller:this})},onCustomerValueHelpConfirm(e){const{selectedItem:t}=e.getParameters();if(!t)return;const o=t.getBindingContext();this.getModel("main").setProperty("/header/customer/id",o.getProperty("name"));this.getModel("main").setProperty("/header/customer/name",o.getProperty("description"))},onCategoryListItemPress(e){const t=e.getParameter("item");const o=this.byId("lista_odv");const s=o.getBinding("items");const n=t.getKey();const i=n==="ALL"?[]:[new r("category",a.EQ,n)];s.filter(i)},onCatalogValueHelpRequest(){s.getCatalogValueHelp({controller:this})},onCatalogValueHelpConfirm(e){const{selectedItems:t}=e.getParameters();if(!t.length)return;const o=this.getModel("proposta").getProperty("/table/items");t.forEach(e=>o.unshift(e.getBindingContext().getObject()));this.getModel("proposta").setProperty("/table/items",o)},onAddRowPress(e){const t=e.getSource().getParent().getParent();const o=t.getModel("proposta").getProperty("/table/items");o.unshift({selected:false,highlight:"Indication01",category:"",product:"",description:"",u_acq:"",u_prz:"",u_qta:"",price:"",unit_of_measure:"KG",quantity:"",disponibilita:""});t.getModel("proposta").setProperty(`/table/items`,o)},onAddNotePress(e){const t=e.getSource();const o=t.getBindingContext("proposta").getObject();s.getAddNoteDialog({controller:this,prodotto:o})},onShowPhotoPress(e){const t=e.getSource().getProperty("src");s.getPhotoDialog({controller:this,src:t})},onPanelProcessFlowExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const s=o.getContent()[0].getItems()[1].getItems()[0];const{top:r}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{s.setZoomLevel("Four");t.getScrollDelegate().scrollTo(0,r)},500)}},onPanelPosizioniExpand(e){const{expand:t}=e.getParameters();if(t){const t=this.byId("dettaglio_ordine");const o=e.getSource();const{top:s}=$(o.getParent().getParent().getDomRef()).offset();setTimeout(()=>{t.getScrollDelegate().scrollTo(0,s)},500)}},onCreaOdvPress(){s.getCreaOdVDialog({controller:this})},onCreaOdvConfirm(){i.success("Ordine di vendita creato con successo",{onClose:()=>sap.m.InstanceManager.closeAllDialogs()})},onShowFormPress(e){const t=e.getSource();const o=t.getParent();o.getModel().setProperty("/formVisible",!o.getModel().getProperty("/formVisible"))}})});
//# sourceMappingURL=Main.controller.js.map